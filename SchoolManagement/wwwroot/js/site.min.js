"use strict";var app=function(){var t={locale:"pl",icons:{time:"fas fa-clock",date:"fa fa-calendar"}};return{gridRowClick:function(e){document.addEventListener("rowclick",function(t){var a=t.detail.data.id;app.goTo("".concat(e,"?id=").concat(a))})},module:function(t){return void 0===t?{}:t},formToJSON:function(e){var t=e.serializeArray(),n={};return $.map(t,function(t,a){n[t.name]?n[t.name].push(t.value):1<e.find('input[name="'+t.name+'"]').length?n[t.name]=[t.value]:n[t.name]=t.value}),n},sendForm:function(t,a){var e=t.attr("action"),n=t.serializeArray();$.post(e,n).done(function(t){void 0!==a&&a()})},tableLanguage:{processing:"Przetwarzanie",search:"Szukaj:",lengthMenu:"Pokaż _MENU_ wpisów",info:"Pokazuje _START_ do _END_ z _TOTAL_ dostępnych wpisów",infoEmpty:"Pokazuje 0 do 0 z 0 wpisów ",infoFiltered:"(przefiltrowano z _MAX_ dostępnych wpisów)",infoPostFix:"",loadingRecords:"Ładowanie danych",zeroRecords:"Nie odnaleziono rekordów",emptyTable:"Brak danych",paginate:{first:"Pierwszy",previous:"Poprzedni",next:"Następny",last:"Ostatni"},aria:{sortAscending:": aktywuj aby sortować rosnąco",sortDescending:": aktywuj aby sortować malejąco"}},rowClickAndGoToByIdEvent:function(o,s){o.on("click","tbody",function(t){if("none"===window.getComputedStyle(t.target,":before").content){var a=t.target.closest("tr");if("child"===a.className){var e=$(a).parent().children(),n=e.index(a);a=e[n-1]}var i=o.row(a).data().id;app.goTo("".concat(s,"?id=").concat(i))}})},goTo:function(t){location.href=location.origin+t},getCalendarDefaultOptions:function(){return t},arrayRemove:function(t,a){return t.filter(function(t){return t!==a})},selectInit:function(t){$(t).select2({language:"pl",width:"100%",theme:"bootstrap4"})},selectInitRemote:function(e,t,n,i){$(e).select2({language:"pl",width:"100%",theme:"bootstrap4",ajax:{url:t,type:"POST",data:function(t){var a={term:t.term};return void 0!==i&&(a.exclude=i()),a},delay:250,dataType:"json"}}),$(e).on("select2:selecting",function(t){if(void 0!==n){var a=t.params.args.data.id;return n(a),$(e).select2("close"),!1}})},successMessage:function(t){new Noty({theme:"bootstrap-v4",type:"success",timeout:1e3,killer:!0,text:t}).show()},addUtcToForm:function(t){var a=moment().utcOffset();moment().isDST()&&(a+=60);var e=$("<input class='d-none' id='UtcOffsetInMinutes' value='".concat(a,"' name='utcOffsetInMinutes'/>\""));$("#".concat(t)).append(e)},errorMessage:function(t){new Noty({theme:"bootstrap-v4",type:"error",timeout:1e3,killer:!0,text:t}).show()},resultStatus:{success:0,warning:1,error:2}}}();app.table=app.module(app.table),app.table=function(){function o(t){return this.tableOptions.columns=t,this}function s(t){return this.rowClick.isSet=!0,this.rowClick.url=t,this}function r(t){return this.tableOptions.data=t,this}function c(t){return this.selector.find(".card-header > .title").text(t),this}function l(){var t=this.selector.find("table").DataTable(this.tableOptions);this.rowClick.isSet&&app.rowClickAndGoToByIdEvent(t,this.rowClick.url)}return{createTable:function(t){var a=$("#".concat(t));a.addClass("card shadow mb-4");var e=$('<div class="card-header py-3">\n                                    <h6 class="m-0 font-weight-bold text-primary title"></h6>\n                                </div>'),n=$('<div class="card-body">\n                                <div class="row">\n                                    <div class="col-sm-12"> \n                                        <div class="table-responsive">\n                                            <table id="table-'.concat(t,'" class="table table-bordered table-striped" width="100%"></table>\n                                        </div>\n                                    </div>        \n                                </div>\n                            </div>'));a.append(e),a.append(n);var i={};return i.selector=a,i.withColumns=o,i.withData=r,i.withTitle=c,i.build=l,i.tableOptions={language:app.tableLanguage,responsive:{details:!0}},i.withClickRowAndGotoById=s,i.rowClick={isSet:!1},i}}}(),app.modal=app.module(app.modal),app.modal=function(){function e(){var t=this.selector;$(this.selector).modal("show"),$(this.selector).on("hidden.bs.modal",function(){$(t).remove()})}function n(t){var a=$('<h5 class="modal-title">'.concat(t,"</h5>"));return $(this.selector).find(".modal-header").append(a),this}function i(t){var a=$('<div class="mb-3">'.concat(t,"</div>"));return $(this.selector).find(".modal-body").append(a),this}function o(t){var a=$('<input id="displayName" type=text class="form-control" name="DisplayName" value='.concat(t,">"));return $(this.selector).find(".modal-body").append(a),this}function s(t){var a=$('<button type="button" class="btn btn-secondary" data-dismiss="modal">'.concat(t||"Anuluj","</button>"));return $(this.selector).find(".modal-footer").append(a),this}function r(t){var a=t.text||"Ok",e=t.style||"primary",n=t.onClick||function(){console.log('Button "'.concat(a,'"  clicked.'))},i=$('<button type="button" class="btn btn-'.concat(e,'" data-dismiss="modal">').concat(a,"</button>"));return i.on("click",function(t){n(t)}),$(this.selector).find(".modal-footer").append(i),this}return{create:function(t){var a={};return $("#removeModal".concat(t)).remove(),a.selector="#removeModal".concat(t),function(t){var a=$('<div class="modal fade" id="removeModal'.concat(t,'" tabindex="-1" role="dialog" aria-labelledby="removeModal').concat(t,'Label" aria-hidden="true"></div>')),e=$('<div class="modal-dialog" role="document"></div>'),n=$('<div class="modal-content"></div>'),i=$('<div class="modal-header"></div>'),o=$('<div class="modal-body"></div>'),s=$('<div class="mb-3"></div>'),r=$('<div class="modal-footer"></div>');a.append(e),e.append(n),n.append(i).append(o).append(r),o.append(s),$("body").append(a)}(t),a.withTitle=n,a.withContent=i,a.withInput=o,a.withCancel=s,a.withAccept=r,a.show=e,a}}}(),app.removeDialog=app.module(app.removeDialog),app.removeDialog=function(){var e={};return{showModal:function(a){app.modal.create("RemoveUser").withTitle(e.title).withContent(e.content).withCancel().withAccept({text:"Tak",onClick:function(t){app.removeDialog.remove(a)},style:"danger"}).show()},remove:function(t){$.ajax({url:e.removeUrl,data:JSON.stringify({id:t}),type:"POST",contentType:"application/json",success:function(t){t.status===app.resultStatus.success?window.location.href=e.backUrl:app.errorMessage(t.errorMessage)}})},init:function(t){e=t}}}(),app.login=app.module(app.login),app.login={init:function(){app.addUtcToForm("loginForm")}},app.listOfAnchors=app.module(app.listOfAnchors),app.listOfAnchors={init:function(t){app.table.createTable("anchorsList").withColumns([{title:"Nazwa",data:"name"}]).withData(t.dataSet).withTitle("Lista prowadzących").withClickRowAndGotoById(t.anchorDetail).build()}},app.calendar=app.module(app.calendar),app.calendar.show=function(){function i(){return window.innerWidth<768?{left:"prev ",center:"title",right:"next"}:{left:"prev,next today myCustomButton",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"}}function o(){return window.innerWidth<768?"timeGridDay":"timeGridWeek"}return{init:function(e){var t=i(),a=o(),n=document.getElementById("calendar");new FullCalendar.Calendar(n,{defaultView:a,minTime:"06:00:00",height:"auto",eventSources:[{url:e.eventUrl}],allDaySlot:!1,plugins:["interaction","dayGrid","timeGrid"],locale:"pl",header:t,windowResize:function(){var t=o();this.setOption("header",i(),t),this.render()},eventClick:function(t){e.userCanSeePresence&&(window.location.href="".concat(e.presenceAtDayUrl,"?classTimeId=").concat(t.event._def.publicId))},eventDrop:function(t){var a={id:t.event.id,start:moment(t.event.start).toISOString(),end:moment(t.event.end).toISOString()};$.ajax({url:e.updateClassTimeUrl,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify(a),success:function(){app.successMessage("Przeniesiono zajęcia")}})}}).render()}}}(),app.groupClass=app.module(app.groupClass),app.groupClass.add=function(){var e,s={},n=[];function a(t){$.ajax({contentType:"application/json; charset=utf-8",type:"GET",data:{id:t,role:$("#participantRole input:checked").val()},url:s.getUserUrl,success:function(t){!function(t){e.row.add(t).draw(),n.push(t.id)}(t),function(t){var a=$("#selectedUsers input").length/3,e=$('<input name="participants['.concat(a,'].id" value="').concat(t.id,'" data-id="').concat(t.id,'" />')),n=$('<input name="participants['.concat(a,'].role" value="').concat(t.role,'" data-id="').concat(t.id,'" />')),i=$('<input name="participants['.concat(a,'].name" value="').concat(t.userName,'" data-id="').concat(t.id,'" />'));$("#selectedUsers").append(e,n,i)}(t)}})}function i(){$("#IsSolo:checked").length?(document.getElementById("noneRadio").checked=!0,$("#role-set").hide()):(document.getElementById("leaderRadio").checked=!0,$("#role-set").show())}function r(t){var a=app.getCalendarDefaultOptions();a.format="LT",t.datetimepicker(a)}return{init:function(t){s=t,app.addUtcToForm("addGroupForm"),function(){var t=app.getCalendarDefaultOptions();t.format="L",$("#startDate").datetimepicker(t),$("#startDate").on("change.datetimepicker",function(t){$("#Start").val(moment(t.date).toISOString(!0).substring(0,16))})}(),$("select[name*=DayOfWeek]").map(function(){app.selectInit(this)}),$("input[name*=BeginTime]").map(function(){r($(this).parent())});var a=function(){var t=$("#selectedUsers input[name*='id'").map(function(){return $(this).val()}).get(),e=[];return t.forEach(function(t){var a={};a.id=t,a.roleDescription=$("input[data-id='".concat(t,"'][name*='role']")).data("rolename"),a.userName=$("input[data-id='".concat(t,"'][name*='name']")).val(),e.push(a)}),e}();!function(t){var a={language:app.tableLanguage,searching:!1,info:!1,paging:!1,responsive:{details:!0},columns:[{title:"Imię i nazwisko",data:"userName"},{title:"Rola",data:"roleDescription",width:"15%"},{data:null,targets:-1,defaultContent:'<button class="btn btn-danger btn-sm" type="button" onclick="app.groupClass.add.remove(this)"><i class="fas fa-user-times"></i></button>',width:"5%"}]};void 0!==t&&(a.data=t),e=$("#participantsTable").DataTable(a)}(a),a.forEach(function(t){n.push(t.id)}),$("#IsSolo").on("change",function(){i()}),i()},addUserToTable:function(t){a(t)},remove:function(t){var a=e.row(t.closest("tr"));!function(t){n=app.arrayRemove(n,t),$("#selectedUsers input[data-id=".concat(t,"]")).remove()}(a.data().id),a.remove().draw()},getSelectedUser:function(){return n},addTerm:function(){var t=$("#terms"),a=t.children().length,e=$("<div class='form-row' id='term-".concat(a,"'></div>")),n=$("<div class='form-group col-md-6'>\n                                    <label for='Start'>Termin ".concat(a+1,"</label>\n                                    <select name='DayOfWeeks[").concat(a,"].DayOfWeek' class='form-control'></select>\n                                </div>")),i=$("<div class='form-group col-md-5'>\n                                    <label for='Start'>Godzina rozpoczęcia</label>\n                                    <div class='input-group date' id='startTime-".concat(a,"' data-target-input='nearest'>\n                                        <input type='text' class='form-control' data-target='#startTime-").concat(a,"' name='DayOfWeeks[").concat(a,"].BeginTime' id='BeginTime=").concat(a,"' />\n                                        <div class='input-group-append' data-target='#startTime-").concat(a,"' data-toggle='datetimepicker'>\n                                            <div class='input-group-text'><i class='fa fa-clock'></i></div>\n                                        </div>\n                                    </div>\n                               </div>")),o=$("<div class='form-group col-md-1 d-flex align-items-end'>\n                                  <button type='button' onclick='app.groupClass.add.removeTerm(\"#term-".concat(a,"\")' class='btn btn-danger'><span><i class='fa fa-recycle'></i></span></button>\n                              </div>"));!function(t){t.select2({data:s.daysOfWeek,theme:"bootstrap4",language:"pl",width:"100%"})}(n.find("select")),r(i.find("#startTime-".concat(a))),e.append(n),e.append(i),e.append(o),t.append(e)},removeTerm:function(t){$(t).remove()}}}(),app.groupClass=app.module(app.groupClass),app.groupClass.detail=function(){var d={};function a(t){$.ajax({url:t.presenceUrl,type:"GET",contentType:"application/json",success:function(t){!function(i){var e=$("#participantPresenceTable > thead >tr"),t=$("<th>Uczestnik</th>");e.append(t),i.columns.forEach(function(t){var a=$("<th>".concat(t,"</th>"));e.append(a)});var a=i.participantsPresence,n=$("#participantPresenceTable > tbody");for(var o in a)if(a.hasOwnProperty(o)){var s=a[o],r=$("<tr><td>".concat(s.participantName,"</td></tr>")),c=s.presenceValues;for(var l in i.columns){var p;if(i.columns.hasOwnProperty(l))!function(){var a=i.columns[l],t=c.filter(function(t){return t.date===a});if(1===t.length){p="",t[0].value&&(p="checked");var e=$("<td><input type='checkbox' ".concat(p,' data-toggle="toggle"  data-onstyle="success" data-offstyle="danger" data-participantId=\'').concat(s.participantId,"' data-classTimeId='").concat(t[0].id,"'/></td>"));r.append(e)}else{var n=$("<td>X</td>");r.append(n)}}()}n.append(r)}$("input[data-toggle*=toggle]").bootstrapToggle({size:"xs",on:"",off:""}),$("#participantPresenceTable").DataTable({language:app.tableLanguage,scrollCollapse:!0,scrollY:"1000px",scrollX:!0,paging:!1,fixedColumns:!0}),$("input[data-toggle*=toggle]").change(function(){var t=$(this).prop("checked"),a=$(this).data("participantid"),e=$(this).data("classtimeid");app.presence.show.changePresence(a,e,t,app.presence.show.presenceType.Member,d.changePresenceUrl)})}(t)}})}return{init:function(t){!function(i){$("#participantsTable").DataTable({language:app.tableLanguage,ajax:{url:i.membersUrl,dataSrc:""},responsive:{details:!0},columns:[{title:"Imię i nazwisko",data:"userName"},{title:"Rola",data:"roleDescription",width:"15%"},{title:"Karnet",render:function(t,a,e){return e.passWasPaid?"Opłacono":"Nie opłacono"},width:"15%"},{title:"",render:function(t,a,e){var n="<div class='d-flex justify-content-center'><a role='button' title='Edytuj uczestnika' class='btn btn-primary btn-xs mr-2' href='".concat(i.memberDetail,"?memberId=").concat(e.memberId,"'><i class='far fa-edit'></i></a>");return!e.passWasPaid&&i.userHasPermissionToSetPassAsPaid&&(n+="<button type='button' title='Oznacz jako zapłacone' class='btn btn-success btn-xs mr-2' onclick='app.groupClass.detail.setAsPaid(\"".concat(e.memberId,'")\'><i class="fas fa-money-bill-wave-alt"></i></button>')),n+="</div>"},width:"10%"}],rowCallback:function(t,a){a.passWasPaid||($(t).addClass("notPayment"),$(t).removeClass("odd"))}})}(t),a(t),d=t},setAsPaid:function(t){app.modal.create().withTitle("Zmiana statusu karnetu").withContent("Czy chcesz oznaczyć karnet jako opłacony?").withAccept({text:"Tak",onClick:function(){$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:d.changePassStatus,data:JSON.stringify({memberId:t}),success:function(){app.successMessage("Zmienieno status karnetu"),$("#participantsTable").DataTable().ajax.reload()}})}}).withCancel("Nie").show()}}}(),app.groupClass=app.module(app.groupClass),app.groupClass.list={init:function(t){app.table.createTable("groupClassList").withColumns([{title:"Nazwa",data:"name"},{title:"Limit miejsc",data:"limitParticipants"},{title:"Obecna liczba uczestników",data:"currentParticipants"}]).withData(t.dataSet).withTitle("Zajęcia grupowe").withClickRowAndGotoById(t.editRoom).build()}},app.groupClass=app.module(app.groupClass),app.groupClass.participantImport=function(){var o={};function a(){var t=$("#fUpload").val();if(0===t.length)return alert("Please select a file."),!1;var a=t.replace(/^.*\./,"");if(-1==$.inArray(a,["xls","xlsx"]))return alert("Please select only excel files."),!1;var e=new FormData,n=$("#fUpload").get(0).files;e.append(n[0].name,n[0]);var i=$("input[name='GroupId']").val();e.append("id",i),$.ajax({type:"POST",url:o.url,beforeSend:function(t){t.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},data:e,contentType:!1,processData:!1,success:function(t){0===t.length?alert("Some error occured while uploading"):app.successMessage("Dodano użytkowników do grupy")},error:function(t){$("#dvData").html(t.responseText)}})}return{init:function(t){o=t,$("#btnUpload").on("click",a)}}}(),app.groupMember=app.module(app.groupMember),app.groupMember.edit=function(){var a={};return{passRemoveDialog:function(t){app.removeDialog.init(a.removeDialog),app.removeDialog.showModal(t)},init:function(t){a=t}}}(),app.listOfParticipants=app.module(app.listOfParticipants),app.listOfParticipants={init:function(t){app.table.createTable("participantList").withColumns([{title:"Nazwa",data:"name"}]).withData(t.dataSet).withTitle("Lista uczestników").withClickRowAndGotoById(t.participantDetail).build()}},app.presence=app.module(app.presence),app.presence.show=function(){var e={},n={None:0,Member:1,Help:2,MakeUp:3};function i(t,a){app.presence.show.changePresence(t,e.classTimeId,!0,a,e.changePresenceUrl)}return{init:function(t){$("input[data-toggle*=toggle]").bootstrapToggle({size:"small",on:"",off:""}),$("#participantPresenceTable").DataTable({language:app.tableLanguage,responsive:{details:!0}}),$("#additionalParticipantPresenceTable").DataTable({language:app.tableLanguage,responsive:{details:!0}}),e=option,$("input[data-toggle*=toggle]").change(function(){var t=$(this).prop("checked"),a=$(this).data("participantid");app.presence.show.changePresence(a,e.classTimeId,t,n.Member,e.changePresenceUrl)}),$("button[class*=participant-remove]").click(function(){var t=$(this).data("participantid"),a=$(this).data("presencetype");app.presence.show.changePresence(t,e.classTimeId,!1,a,e.changePresenceUrl)})},presenceType:n,changePresence:function(t,a,e,n,i){var o={participantId:t,classTimeId:a,isPresence:e,presenceType:n};$.ajax({url:i,type:"POST",data:JSON.stringify(o),dataType:"json",contentType:"application/json",success:function(t){t.status===app.resultStatus.success?app.successMessage("Uaktualniono obecność użytkownika"):app.errorMessage(t.message)}})},addUser:function(t){$.ajax({type:"GET",data:{userId:t},url:e.getNewParticipantDetailUrl,contentType:"application/json",success:function(t){if(t.status===app.resultStatus.success){var a=app.modal.create().withTitle("Dodanie uczestnika z poza listy").withContent("Czy chesz dodać uczestnika <strong>".concat(t.data.name,"</strong> jako dodatkowego uczestnika zajęć?<br/><br/> Oznacz zajęcia jako:")).withCancel("Nie").withAccept({text:"Pomoc",style:"success",onClick:function(){i(t.data.id,n.Help)}});t.data.wasAbsent&&(a=a.withAccept({text:"Odrabianie",onClick:function(){i(t.data.id,n.MakeUp)}})),a.show()}}})}}}(),app.anchors=app.module(app.anchors),app.anchors.assign=app.module(app.anchors.assign),app.anchors.assign={init:function(){$("#userList").select2({language:"pl",width:"100%"})}},app.room=app.module(app.room),app.room.add={init:function(){$("#roomColor").colorpicker({useHashPrefix:!1})}},app.rooms=app.module(app.rooms),app.rooms={init:function(t){app.table.createTable("roomList").withColumns([{title:"Nazwa pokoju",data:"name"}]).withData(t.dataSet).withTitle("Lista pokoi").withClickRowAndGotoById(t.editRoom).build()}},app.userList=app.module(app.userList),app.userList={init:function(t){app.table.createTable("userList").withColumns([{title:"Imię",data:"firstName"},{title:"Nazwisko",data:"lastName"},{title:"E-mail",data:"email"},{title:"Rola",data:"roleName"}]).withData(t.dataSet).withTitle("Lista użytkowników").withClickRowAndGotoById(t.editUserUrl).build()}};